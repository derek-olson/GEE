//Get datasets as assets
var climate = climPCA.clip(sa).select([0]).multiply(10000).int16();
var topo = topoAll.clip(sa).select([0,1,4,5,6]);
var ndvi = LCMS.normalizedDifference(['nir','red']).multiply(10000).int16();
ndvi = ndvi.clip(sa);

//Create composite
var composite = climate.addBands(topo).addBands(ndvi);
print(composite);

//Load reference data
var ref = ee.FeatureCollection('ft:1UuFquverkIKyJf09aDxGdFU9Y4V3jVIkLhwZ2J-W');

//Create segments
var segments = ee.Algorithms.Image.Segmentation.GMeans({
  image: composite, 
  numIterations: 10, 
  pValue: 50, 
  neighborhoodSize: 0, 
  gridSize: null,
  uniqueLabels: true
});

//Calculate zonal statistics
var zstats = nlDiff.reduceRegions({
  reducer: ee.Reducer.mean().group({
    groupField: 1,
    groupName: 'code',
  }),
  geometry: region.geometry(),
  scale: 30,
  maxPixels: 1e8
});

// Print the resultant Dictionary.
print(zstats);

var rf = ee.Classifier.randomForest({
  numberOfTrees: 1000,
  variablesPerSplit: 0,
  minLeafPopulation: 1, 
  bagFraction: 0, 
  outOfBagMode: false,
  seed: 0
  })
  .setOutputMode('CLASSIFICATION')
  .train({
    features: ref,
    classProperty:'levelx',
    inputProperties: composite, 
    subsampling: 1,
    subsamplingSeed: 0
  })
  .confusionMatrix();
  

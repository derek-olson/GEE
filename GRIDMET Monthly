
////////////////////////////////////////////////
var gridmet = ee.ImageCollection('IDAHO_EPSCOR/GRIDMET');
var years = ee.List.sequence(1990,2016);
var months = ee.List.sequence(1,12,1);
var monthSpan = 1;
var reducer = ee.Reducer.sum();
var band_names = ['pr']

function getMonthlySum(year,monthStart,monthEnd,reducer){
  var startDate = ee.Date.fromYMD(year,1,1).advance(monthStart,'month').advance(-1,'month');
  var endDate = ee.Date.fromYMD(year,1,1).advance(monthEnd,'month').advance(-1,'month').advance(-1,'day');
  
  var gridmetT = gridmet.filterDate(startDate,endDate)
                .select(band_names);
  gridmetT = gridmetT.reduce(reducer);
  gridmetT = gridmetT.set('system:time_start',startDate.millis());
  return gridmetT
}



function iterateGetYearlyMonthlySum(years,months,monthSpan,reducer){
  var stack =years.map(function(yr){
    return months.map(function(month){
      var startMonth = month;var endMonth = ee.Number(month).add(monthSpan);
      
      return getMonthlySum(yr,startMonth,endMonth,reducer)
    })
  })
  stack = ee.ImageCollection(ee.List(stack).flatten()).sort('system:time_start');
  return stack
}

var precipSumStack =iterateGetYearlyMonthlySum(years,months,monthSpan,reducer)
Map.addLayer(precipSumStack.median(),{'min':0,'max':100},'Median Monthly Sum')